<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DRABISS - Acc√®s IA</title>

  <!-- Script Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs, updateDoc } 
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // üîë Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDaLEfamwm6GSFGNH_lyIoKaNgsVggkVKM",
      authDomain: "drabiss.firebaseapp.com",
      projectId: "drabiss",
      storageBucket: "drabiss.firebasestorage.app",
      messagingSenderId: "218797430971",
      appId: "1:218797430971:web:102ba8065ef6f4967d319e",
      measurementId: "G-3CWXB9VPDM"
    };

    // Initialisation
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ‚úÖ Fonction de validation
    async function validerCode() {
      const inputCode = document.getElementById("codeInput").value.trim();
      const q = query(collection(db, "codes"), where("code", "==", inputCode));
      const querySnapshot = await getDocs(q);

      if (querySnapshot.empty) {
        alert("‚ùå Code invalide !");
        return;
      }

      const docRef = querySnapshot.docs[0].ref;
      const data = querySnapshot.docs[0].data();
      const now = new Date();

      if (data.used) {
        alert("‚ö†Ô∏è Code d√©j√† utilis√© !");
        return;
      }

      if (new Date(data.expiresAt) < now) {
        alert("‚åõ Code expir√© !");
        return;
      }

      // Marquer comme utilis√©
      await updateDoc(docRef, { used: true });

      // Sauvegarder l‚Äôacc√®s localement
      localStorage.setItem("accesIA", "true");

      // Redirection vers la page IA
      window.location.href = "ia.html";
    }

    // Rendre la fonction accessible au bouton
    window.validerCode = validerCode;
  </script>
</head>
<body>
  <h1>DRABISS</h1>
  <p>Entre ton mot de passe :</p>

  <!-- Champ pour entrer le code -->
  <input id="codeInput" type="text" placeholder="Mot de passe" />

  <!-- Bouton pour valider -->
  <button onclick="validerCode()">Valider</button>
</body>
</html>
